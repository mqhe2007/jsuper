{"version":3,"file":"index.js","sources":["../src/platform.js","../src/no-action-listener.js","../src/uuid.js","../src/find-node-from-tree.js","../src/tree-map.js","../src/flat-to-tree.js","../src/event-bus.js","../src/position.js","../src/tree-filter.js"],"sourcesContent":["/**\n * 获取当前运行平台标识\n * @module\n * @returns {String} 返回平台标识：desktop|wechat|ios|android\n */\nfunction platform() {\n  var ua = navigator.userAgent.toLowerCase();\n  if (ua.indexOf(\"micromessenger\") !== -1) return \"wechat\";\n  if (ua.indexOf(\"iphone\") !== -1 || ua.indexOf(\"ipad\") !== -1) return \"ios\";\n  if (ua.indexOf(\"android\") !== -1) return \"android\";\n  return \"desktop\";\n}\nexport default platform;\n","/**\n * 无动作监听器\n */\nclass NoActionListener {\n  /**\n   * 构造函数\n   * @param {Number} delayTime - 超时时长，单位秒。\n   * @param {Function} timeoutHandler - 超时后处理函数\n   */\n  constructor(delayTime, timeoutHandler) {\n    this.delayTime = delayTime; // 单位秒\n    this.timeoutHandler = timeoutHandler;\n    this.timer = undefined;\n  }\n  /**\n   * 开始监听\n   */\n  listen() {\n    window.addEventListener(\"click\", this.resetTime);\n    window.addEventListener(\"keydown\", this.resetTime);\n    window.addEventListener(\"mousemove\", this.resetTime);\n    window.addEventListener(\"mousewheel\", this.resetTime);\n  }\n  /**\n   * 清理监听\n   */\n  clearListen() {\n    clearTimeout(this.timer);\n    window.removeEventListener(\"click\", this.resetTime);\n    window.removeEventListener(\"keydown\", this.resetTime);\n    window.removeEventListener(\"mousemove\", this.resetTime);\n    window.removeEventListener(\"mousewheel\", this.resetTime);\n  }\n  resetTime() {\n    clearTimeout(this.timer);\n    this.timer = setTimeout(() => {\n      this.timeoutHandler();\n      this.clearListen();\n      this.timer = undefined;\n    }, this.delayTime * 1000);\n  }\n}\nexport default NoActionListener;\n","/**\n * 生成uuid\n * @module\n * @return {String} uuid字符串\n */\nfunction uuid() {\n  let d = new Date().getTime();\n  if (window.performance && typeof window.performance.now === \"function\") {\n    d += performance.now();\n  }\n  let template = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxx\";\n  let uuid = template.replace(/[xy]/g, function (c) {\n    let r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == \"x\" ? r : (r & 0x3) | 0x8).toString(16);\n  });\n  return uuid;\n}\nexport default uuid;\n","/**\n * 从树结构中找到某个节点\n * @module\n * @param {Array} kv - 需要匹配的键值对\n * @param {Array} treeData - 树结构数据\n * @param {Boolean} hasParent - 是否包含父级节点\n */\nfunction findNodeFromTree(kv, treeData, hasParent) {\n  for (let i = 0; i < treeData.length; i++) {\n    const node = treeData[i];\n    if (node[kv[0]] === kv[1]) {\n      return node;\n    } else {\n      if (node.children && node.children.length > 0) {\n        const result = findNodeFromTree(kv, node.children);\n        if (result) {\n          if (hasParent) {\n            result.parent = node;\n          }\n          return result;\n        } else {\n          return undefined;\n        }\n      }\n    }\n  }\n}\nexport default findNodeFromTree;\n","/**\n * 对一个树形结构做递归map操作\n * @module\n * @param {Array} nodes - 树结构数组\n * @param {Function} handler - 数据处理程序。\n * @param {Number} depth - 递归的深度值，初始为1\n * @param {String} childrenKey - 子集的key\n */\nfunction treeMap(nodes, handler, childrenKey = \"children\", depth = 1) {\n  return nodes.map(item => {\n    let _item = handler(item, depth);\n    if (item[childrenKey] && item[childrenKey].length > 0) {\n      _item.children = treeMap(\n        item[childrenKey],\n        handler,\n        childrenKey,\n        depth + 1\n      );\n    }\n    return _item;\n  });\n}\nexport default treeMap;\n","/**\n * 扁平化结构数据转换成树结构\n * @module\n * @param {Object[]} flatArray - 扁平结构的数组\n * @param {String} key - 用于指定元素的key\n * @param {String} parentkey - 用于指定元素的父元素的key\n * @returns {Object[]} 由树结构组成的数组\n */\nfunction flatToTree(flatArray, key, parentkey) {\n  let result = [];\n  const buildParent = function (item) {\n    const parentIndex = flatArray.findIndex(\n      (item_) => item_[key] === item[parentkey]\n    );\n    if (parentIndex > -1) {\n      const parent = flatArray.splice(parentIndex, 1)[0];\n      parent.children = [];\n      parent.children.push(item);\n      if (!parent[parentkey]) {\n        return parent;\n      } else {\n        return buildParent(parent);\n      }\n    } else {\n      return item;\n    }\n  };\n  flatArray.forEach((item) => {\n    if (!item[parentkey]) {\n      result.push(item);\n    } else {\n      result.push(buildParent(item));\n    }\n  });\n  return result;\n}\nexport default flatToTree;\n","/**\n * 事件总线\n */\nclass EventBus {\n  /**\n   * 构造函数\n   */\n  constructor() {\n    this.events = {};\n  }\n  /**\n   * 发射\n   * @param {String} eventName - 事件名称\n   * @param {Any} payload - 事件载荷\n   */\n  emit(eventName, payload) {\n    if (!this.events[eventName])\n      return console.warn(\n        `${eventName}事件触发了，但是没有监听者，什么都不会发生。`\n      );\n    for (let func of this.events[eventName].values()) {\n      func(payload);\n    }\n  }\n  /**\n   * 监听\n   * @param {String} eventName - 事件名称\n   * @param {Function} handler - 回调处理程序\n   */\n  on(eventName, handler) {\n    if (typeof handler === \"function\") {\n      if (!this.events[eventName]) this.events[eventName] = new Set();\n      this.events[eventName].add(handler);\n    }\n  }\n  /**\n   * 取消一个监听程序\n   * @param {String} eventName - 事件名称\n   * @param {Function} handler - 回调处理程序\n   */\n  off(eventName, handler) {\n    if (!handler) return console.warn(`取消监听必须传入已被监听的事件处理函数`);\n    this.events[eventName].delete(handler);\n  }\n  /**\n   * 清理事件总线\n   */\n  clear() {\n    this.events = {};\n  }\n  /**\n   * 获取事件清单\n   */\n  getEvents() {\n    return this.events;\n  }\n}\nexport default EventBus;\n","/**\n * 获取元素在页面中的绝对位置\n * @module\n * @returns {Object} 返回距离顶和左的绝对像素值：{top:0, left: 0}\n */\nfunction position(el) {\n  function getElementLeft(element) {\n    var actualLeft = element.offsetLeft;\n    var current = element.offsetParent;\n\n    while (current !== null) {\n      actualLeft += current.offsetLeft;\n      current = current.offsetParent;\n    }\n\n    return actualLeft;\n  }\n\n  function getElementTop(element) {\n    var actualTop = element.offsetTop;\n    var current = element.offsetParent;\n\n    while (current !== null) {\n      actualTop += current.offsetTop;\n      current = current.offsetParent;\n    }\n\n    return actualTop;\n  }\n  return {\n    top: getElementTop(el),\n    left: getElementLeft(el),\n  };\n}\nexport default position;\n","/**\n * 对一个树形结构做递归filter操作\n * @module\n * @param {Array} nodes - 树结构数组\n * @param {Function} handler - 数据处理程序。\n * @param {Number} depth - 递归的深度值，初始为1\n */\nfunction treeFilter(nodes, handler, depth = 1) {\n  return nodes.filter(item => {\n    let result = handler(item, depth);\n    if (result) {\n      if (item.children && item.children.length > 0) {\n        item.children = treeFilter(item.children, handler, depth + 1);\n      }\n    }\n    return result;\n  });\n}\nexport default treeFilter;\n"],"names":["platform","ua","navigator","userAgent","toLowerCase","indexOf","NoActionListener","delayTime","timeoutHandler","timer","undefined","window","addEventListener","resetTime","clearTimeout","removeEventListener","setTimeout","clearListen","uuid","d","Date","getTime","performance","now","template","replace","c","r","Math","random","floor","toString","findNodeFromTree","kv","treeData","hasParent","i","length","node","children","result","parent","treeMap","nodes","handler","childrenKey","depth","map","item","_item","flatToTree","flatArray","key","parentkey","buildParent","parentIndex","findIndex","item_","splice","push","forEach","EventBus","events","eventName","payload","console","warn","values","func","Set","add","position","el","getElementLeft","element","actualLeft","offsetLeft","current","offsetParent","getElementTop","actualTop","offsetTop","top","left","treeFilter","filter"],"mappings":"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"}